<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="io.choerodon.devops.infra.mapper.PipelineAppDeployMapper">
    <select id="queryById" resultType="io.choerodon.devops.infra.dataobject.PipelineAppDeployDO">
       SELECT
            dpt.type,
            dpt. NAME,
            da. NAME AS applicationName,
            dpad.application_id,
            dpad.trigger_version,
            dpad.env_id,
            de. NAME AS envName,
            dpad.instance_id,
            dpad.instance_name,
            dadv.VALUE,
            dpad.value_id,
            dpad.object_version_number,
            dpad.env_id,
            dpad.project_id,
            dpad.id
        FROM
            devops_pipeline_app_deploy dpad
        JOIN devops_application da ON dpad.application_id = da.id
        JOIN devops_env de ON dpad.env_id = de.id
        JOIN devops_pipeline_task dpt ON dpt.app_deploy_id = dpad.id
        JOIN devops_pipeline_app_deploy_value dadv ON dadv.id = dpad.value_id
        WHERE
            dpad.id = #{appDeployId}
    </select>
</mapper>
